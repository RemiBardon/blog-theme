<ul class="category-grid">
  {{- range (partial "profile_filter.html" site.Menus.main) }}
  <li class="category-card" {{ (partialCached "category-card-style.html" . .) | safeHTMLAttr }}>
    <img src="{{ partialCached "category-icon-link.html" . . }}" width="48" height="48" />
    <div>
      <span class="title">{{ .Page.Title | markdownify }}</span>
      {{- $postCount := (i18n "post_count" (partial "profile_filter.html" .Page.RegularPagesRecursive | len)) | default (printf "%d post(s)" .Page.Pages.Len) }}
      {{- $lastPostDate := time.Format ":date_medium" ((index .Page.Pages.ByDate.Reverse 0).Date) }}
      <div class="subtitle">{{ printf "%s Â· %s" $postCount $lastPostDate }}</div>
    </div>
    <a href="{{ .Page.Permalink }}" class="entry-link"></a>
  </li>
  {{- end }}
</ul>

{{ define "partials/category-card-style.html" }}
{{ $style := "" }}

{{ with .Params.colorHSL }}
{{ $style = (printf "style=\"border: 1.5px solid hsl(%s); background-color: hsla(%s / .25);\"" . .) }}
{{ else }}
{{ errorf "Menu item '%s' is missing param 'colorHSL'" .Name }}
{{ end }}

{{/* `return` statement can't go in the `with` as its scope is the function body's */}}
{{ return $style }}
{{ end }}

{{ define "partials/category-icon-link.html" }}
{{ $icon := "" }}

{{ with .Params.icon }}
{{ $icon = (printf "%s/%s" site.BaseURL .) }}
{{ else }}
{{ errorf "Menu item '%s' is missing param 'icon'" .Name }}
{{ end }}

{{/* `return` statement can't go in the `with` as its scope is the function body's */}}
{{ return $icon }}
{{ end }}
