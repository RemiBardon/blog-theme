<ul class="category-grid">
  {{ range (sort (partial "profile_filter.html" .Site.Taxonomies.categories) ".Page.Weight") }}
  <li class="category-card" {{ (partialCached "category-card-style.html" .Page .Page) | safeHTMLAttr }}>
    <img src="{{ partialCached "category-icon-link.html" .Page .Page }}" width="48" height="48" />
    <div>
      <span class="title">{{ .Page.Title | markdownify }}</span>
      {{- $postCount := (i18n "post_count" .Count) | default (printf "%d post(s)" .Count) }}
      {{- $lastPostDate := time.Format ":date_medium" ((index .Pages.ByDate.Reverse 0).Date) }}
      <div class="subtitle">{{ printf "%s Â· %s" $postCount $lastPostDate }}</div>
    </div>
    <a href="{{ .Page.Permalink }}" class="entry-link"></a>
  </li>
  {{ end }}
</ul>

{{ define "partials/category-card-style.html" }}
{{ $style := "" }}

{{ with .Params.colorHSL }}
{{ $style = (printf "style=\"border: 1.5px solid hsl(%s); background-color: hsla(%s / .25);\"" . .) }}
{{ else }}
{{ errorf "Category '%s' is missing param 'colorHSL'" .Title }}
{{ end }}

{{/* `return` statement can't go in the `with` as its scope is the function body's */}}
{{ return $style }}
{{ end }}

{{ define "partials/category-icon-link.html" }}
{{ $icon := "" }}

{{ with .Params.icon }}
{{ $icon = (printf "%s/%s" $.Site.BaseURL .) }}
{{ else }}
{{ errorf "Category '%s' is missing param 'icon'" .Title }}
{{ end }}

{{/* `return` statement can't go in the `with` as its scope is the function body's */}}
{{ return $icon }}
{{ end }}
